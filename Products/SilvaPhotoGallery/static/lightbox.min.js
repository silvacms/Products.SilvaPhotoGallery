function getPageScroll(){var e;return self.pageYOffset?e=self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?e=document.documentElement.scrollTop:document.body&&(e=document.body.scrollTop),arrayPageScroll=new Array("",e),arrayPageScroll}function getPageSize(){var e,t;window.innerHeight&&window.scrollMaxY?(e=document.body.scrollWidth,t=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,t=document.body.scrollHeight):(e=document.body.offsetWidth,t=document.body.offsetHeight);var n,r;return self.innerHeight?(n=self.innerWidth,r=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(n=document.documentElement.clientWidth,r=document.documentElement.clientHeight):document.body&&(n=document.body.clientWidth,r=document.body.clientHeight),t<r?pageHeight=r:pageHeight=t,e<n?pageWidth=n:pageWidth=e,arrayPageSize=new Array(pageWidth,pageHeight,n,r),arrayPageSize}function getKey(e){e==null?keycode=event.keyCode:keycode=e.which,key=String.fromCharCode(keycode).toLowerCase(),key=="x"}function listenKey(){document.onkeypress=getKey}function showSelectBoxes(){selects=document.getElementsByTagName("select");for(i=0;i!=selects.length;i++)selects[i].style.visibility="visible"}function showObjects(){objects=document.getElementsByTagName("object");for(i=0;i!=objects.length;i++)objects[i].style.visibility="visible"}function hideSelectBoxes(){selects=document.getElementsByTagName("select");for(i=0;i!=selects.length;i++)selects[i].style.visibility="hidden"}function hideObjects(){objects=document.getElementsByTagName("object");for(i=0;i!=objects.length;i++)objects[i].style.visibility="hidden"}function pause(e){var t=new Date,n=t.getTime()+e;for(;;){t=new Date;if(t.getTime()>n)return}}function slideshow_start(e){slide=!0,myTimer=setTimeout(slideshow_next,document.getElementById("timeSelect").value),Element.hide("prevLink"),Element.hide("nextLink")}function slideshow_next(){slide&&(activeImage==imageArray.length-1&&myLightbox.end(),myLightbox.changeImage(activeImage+1))}function slideshow_stop(){slide=!1,clearTimeout(myTimer)}function initLightbox(){myLightbox=new Lightbox}var fileLoadingImage="/++static++/Products.SilvaPhotoGallery/loading.gif",fileBottomNavCloseImage="/++static++/Products.SilvaPhotoGallery/close.gif",resizeSpeed=7,borderSize=10,imageArray=new Array,activeImage,slide=!1,myTimer;resizeSpeed>10&&(resizeSpeed=10),resizeSpeed<1&&(resizeSpeed=1),resizeDuration=(11-resizeSpeed)*.15,Object.extend(Element,{getWidth:function(e){return e=$(e),e.offsetWidth},setWidth:function(e,t){e=$(e),e.style.width=t+"px"},setHeight:function(e,t){e=$(e),e.style.height=t+"px"},setTop:function(e,t){e=$(e),e.style.top=t+"px"},setSrc:function(e,t){e=$(e),e.src=t},setHref:function(e,t){e=$(e),e.href=t},setInnerHTML:function(e,t){e=$(e),e.innerHTML=t}}),Array.prototype.removeDuplicates=function(){for(i=1;i<this.length;i++)this[i][0]==this[i-1][0]&&this.splice(i,1)},Array.prototype.empty=function(){for(i=0;i<=this.length;i++)this.shift()};var Lightbox=Class.create();Lightbox.prototype={initialize:function(){if(!document.getElementsByTagName)return;var e=document.getElementsByTagName("a");for(var t=0;t<e.length;t++){var n=e[t],r=String(n.getAttribute("rel"));n.getAttribute("href")&&r.toLowerCase().match("lightbox")&&(n.onclick=function(){return myLightbox.start(this),!1})}var i=document.getElementsByTagName("body").item(0),s=document.createElement("div");s.setAttribute("id","overlay"),s.style.display="none",s.onclick=function(){return myLightbox.end(),!1},i.appendChild(s);var o=document.createElement("div");o.setAttribute("id","lightbox"),o.style.display="none",i.appendChild(o);var u=document.createElement("div");u.setAttribute("id","outerImageContainer"),o.appendChild(u);var a=document.createElement("div");a.setAttribute("id","imageContainer"),u.appendChild(a);var f=document.createElement("img");f.setAttribute("id","lightboxImage"),a.appendChild(f);var l=document.createElement("div");l.setAttribute("id","hoverNav"),a.appendChild(l);var c=document.createElement("a");c.setAttribute("id","prevLink"),c.setAttribute("href","#"),l.appendChild(c);var h=document.createElement("a");h.setAttribute("id","nextLink"),h.setAttribute("href","#"),l.appendChild(h);var p=document.createElement("div");p.setAttribute("id","loading"),a.appendChild(p);var d=document.createElement("a");d.setAttribute("id","loadingLink"),d.setAttribute("href","#"),d.onclick=function(){return myLightbox.end(),!1},p.appendChild(d);var v=document.createElement("img");v.setAttribute("src",fileLoadingImage),d.appendChild(v);var m=document.createElement("div");m.setAttribute("id","imageDataContainer"),m.className="clearfix",o.appendChild(m);var g=document.createElement("div");g.setAttribute("id","imageData"),m.appendChild(g);var y=document.createElement("div");y.setAttribute("id","imageDetails"),g.appendChild(y);var b=document.createElement("span");b.setAttribute("id","caption"),y.appendChild(b);var w=document.createElement("span");w.setAttribute("id","numberDisplay"),y.appendChild(w);var E=document.createElement("div");E.setAttribute("id","bottomNav"),g.appendChild(E);var S=document.createElement("a");S.setAttribute("id","bottomNavClose"),S.setAttribute("href","#"),S.onclick=function(){return myLightbox.end(),!1},E.appendChild(S);var x=document.createElement("img");x.setAttribute("src",fileBottomNavCloseImage),S.appendChild(x)},start:function(e){hideSelectBoxes(),hideObjects();var t=getPageSize();Element.setHeight("overlay",t[1]),new Effect.Appear("overlay",{duration:.2,from:0,to:.8}),imageArray=[],imageNum=0;if(!document.getElementsByTagName)return;var n=document.getElementsByTagName("a");if(e.getAttribute("rel")=="lightbox")imageArray.push(new Array(e.getAttribute("href"),e.getAttribute("title")));else{for(var r=0;r<n.length;r++){var i=n[r];i.getAttribute("href")&&i.getAttribute("rel")==e.getAttribute("rel")&&imageArray.push(new Array(i.getAttribute("href"),i.getAttribute("title")))}imageArray.removeDuplicates();while(imageArray[imageNum][0]!=e.getAttribute("href"))imageNum++}var t=getPageSize(),s=getPageScroll(),o=s[1]+t[3]/15;Element.setTop("lightbox",o),Element.show("lightbox"),this.changeImage(imageNum)},changeImage:function(e){activeImage=e,Element.show("loading"),Element.hide("lightboxImage"),Element.hide("hoverNav"),Element.hide("prevLink"),Element.hide("nextLink"),Element.hide("imageDataContainer"),Element.hide("numberDisplay"),imgPreloader=new Image,imgPreloader.onload=function(){Element.setSrc("lightboxImage",imageArray[activeImage][0]),myLightbox.resizeImageContainer(imgPreloader.width,imgPreloader.height)},imgPreloader.src=imageArray[activeImage][0]},resizeImageContainer:function(e,t){useableWidth=.9,useableHeight=.8,windowWidth=arrayPageSize[2],windowHeight=arrayPageSize[3],scaleX=1,scaleY=1,e>windowWidth*useableWidth&&(scaleX=windowWidth*useableWidth/e),t>windowHeight*useableHeight&&(scaleY=windowHeight*useableHeight/t),scale=Math.min(scaleX,scaleY),e*=scale,t*=scale,Element.setWidth("lightboxImage",e),Element.setHeight("lightboxImage",t),this.wCur=Element.getWidth("outerImageContainer"),this.hCur=Element.getHeight("outerImageContainer"),this.xScale=(e+borderSize*2)/this.wCur*100,this.yScale=(t+borderSize*2)/this.hCur*100,wDiff=this.wCur-borderSize*2-e,hDiff=this.hCur-borderSize*2-t,hDiff!=0&&new Effect.Scale("outerImageContainer",this.yScale,{scaleX:!1,duration:resizeDuration,queue:"front"}),wDiff!=0&&new Effect.Scale("outerImageContainer",this.xScale,{scaleY:!1,delay:resizeDuration,duration:resizeDuration}),hDiff==0&&wDiff==0&&(navigator.appVersion.indexOf("MSIE")!=-1?pause(250):pause(100)),Element.setHeight("prevLink",t),Element.setHeight("nextLink",t),Element.setWidth("imageDataContainer",e+borderSize*2),this.showImage()},showImage:function(){Element.hide("loading"),new Effect.Appear("lightboxImage",{duration:.5,queue:"end",afterFinish:function(){myLightbox.updateDetails()}}),this.preloadNeighborImages()},updateDetails:function(){Element.show("caption"),Element.setInnerHTML("caption",imageArray[activeImage][1]),imageArray.length>1&&(Element.show("numberDisplay"),Element.setInnerHTML("numberDisplay","Image "+eval(activeImage+1)+" of "+imageArray.length)),new Effect.Parallel([new Effect.SlideDown("imageDataContainer",{sync:!0,duration:resizeDuration+.25,from:0,to:1}),new Effect.Appear("imageDataContainer",{sync:!0,duration:1})],{duration:.65,afterFinish:function(){myLightbox.updateNav()}})},updateNav:function(){Element.show("hoverNav"),activeImage!=0&&(Element.show("prevLink"),document.getElementById("prevLink").onclick=function(){return myLightbox.changeImage(activeImage-1),!1}),activeImage!=imageArray.length-1&&(Element.show("nextLink"),document.getElementById("nextLink").onclick=function(){return myLightbox.changeImage(activeImage+1),!1}),slide&&slideshow_start(),this.enableKeyboardNav()},enableKeyboardNav:function(){document.onkeydown=this.keyboardAction},disableKeyboardNav:function(){document.onkeydown=""},keyboardAction:function(e){e==null?keycode=event.keyCode:keycode=e.which,key=String.fromCharCode(keycode).toLowerCase();if(key=="x"||key=="o"||key=="c")myLightbox.end();else if(key=="p"||keycode==37){if(activeImage!=0){if(slide)return;myLightbox.disableKeyboardNav(),myLightbox.changeImage(activeImage-1)}}else if(key=="n"||keycode==39)if(activeImage!=imageArray.length-1){if(slide)return;myLightbox.disableKeyboardNav(),myLightbox.changeImage(activeImage+1)}},preloadNeighborImages:function(){imageArray.length-1>activeImage&&(preloadNextImage=new Image,preloadNextImage.src=imageArray[activeImage+1][0]),activeImage>0&&(preloadPrevImage=new Image,preloadPrevImage.src=imageArray[activeImage-1][0])},end:function(){this.disableKeyboardNav(),Element.hide("lightbox"),new Effect.Fade("overlay",{duration:.2}),showSelectBoxes(),showObjects(),slideshow_stop()}},Event.observe(window,"load",initLightbox,!1);